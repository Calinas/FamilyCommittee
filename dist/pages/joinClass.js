"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_createClass2=require("./../api/createClass.js"),_common=require("./../utils/common.js"),JoinClass=function(e){function t(){var e,s,n,a;_classCallCheck(this,t);for(var o=arguments.length,r=Array(o),i=0;i<o;i++)r[i]=arguments[i];return s=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.config={navigationBarTitleText:"申请加入班级"},n.data={memberInfo:{},classInfo:{},classId:-1,key:"",createClassInfo:{},name:"",isShare:"",list:[]},n.methods={back:function(){wx.switchTab({url:"zone"})},bindInput:function(e){this[e.currentTarget.id]=e.detail.value,this.$apply()},joinNow:function(){var e=this;(0,_createClass2.joinClass)({class_id:this.classId,join_key:this.key}).then(function(t){var s=t.data;(s.success||"100506"===s.error_code)&&(s.success&&(0,_common.showMsg)("成功加入班级"),e.$parent.globalData.classHasChange=!0,wx.setStorage({key:"classInfo",data:t.data.class}),setTimeout(function(){_wepy2.default.navigateTo({url:"bindRelationship?id="+e.classId+"&type=join&key="+e.key})},2e3))})}},a=s,_possibleConstructorReturn(n,a)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e){this.classId=e.classId,this.name=e.name,this.key=e.key,this.memberInfo=wx.getStorageSync("memberInfo"),this.$apply(),this.key&&(this.memberInfo.member_id?this.getClassListInfo().then(function(e){e&&((0,_common.showMsg)("您已经加入该班级，将自动跳转到首页"),setTimeout(function(){wx.switchTab({url:"zone"})},2e3))}):wx.redirectTo({url:"login?classId="+this.classId+"&name="+this.name+"&key="+this.key}))}},{key:"getClassListInfo",value:function(){var e=this;return new Promise(function(t){(0,_createClass2.getClassList)().then(function(s){e.list=s.data.list,e.$apply(),t((0,_common.checkHasJoinClass)(e.classId,e.list))})})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(JoinClass,"pages/joinClass"));